<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BeautyBook - Agendamento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>

</head>
<body class="font-inter bg-gray-50">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 bg-gradient-to-b from-purple-900 to-purple-800 text-white flex flex-col shadow-xl">
            <div class="p-6 border-b border-purple-700">
                <div class="flex items-center gap-3">
                    <span class="material-icons text-3xl">spa</span>
                    <div>
                        <h1 class="text-xl font-bold">BeautyBook</h1>
                        <p class="text-xs text-purple-200">Manicure System</p>
                    </div>
                </div>
            </div>

            <nav class="flex-1 p-4 space-y-2">
                <a href="../dashboard.html" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-purple-700 transition">
                    <span class="material-icons">dashboard</span>
                    <span>Dashboard</span>
                </a>
                
                <a href="../manicures/index.html" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-purple-700 transition">
                    <span class="material-icons">people</span>
                    <span>Manicures</span>
                </a>
                
                <a href="../clientes/index.html" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-purple-700 transition">
                    <span class="material-icons">person</span>
                    <span>Clientes</span>
                </a>
                
                <a href="../horarios/index.html" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-purple-700 transition">
                    <span class="material-icons">schedule</span>
                    <span>Horários</span>
                </a>
                
                <a href="index.html" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-purple-700 text-white">
                    <span class="material-icons">event</span>
                    <span>Agendamentos</span>
                </a>
                
                <a href="../estoque/index.html" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg hover:bg-purple-700 transition">
                    <span class="material-icons">inventory_2</span>
                    <span>Estoque</span>
                </a>
            </nav>

            <div class="p-4 border-t border-purple-700">
                <button onclick="logout()" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg bg-red-600 hover:bg-red-700 transition font-medium">
                    <span class="material-icons">logout</span>
                    <span>Sair</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-auto flex justify-center">
            <div class="w-full p-8">
                <!-- Header -->
                <div class="flex items-center gap-4 mb-8">
                    <button onclick="window.location.href='index.html'" class="text-gray-600 hover:text-gray-800">
                        <span class="material-icons">arrow_back</span>
                    </button>
                    <div>
                        <h2 class="text-3xl font-bold text-gray-800" id="page-title">Novo Agendamento</h2>
                        <p class="text-gray-600 text-sm mt-1">Agende um novo atendimento</p>
                    </div>
                </div>

                <!-- Form -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-12 w-full">
                        <form onsubmit="salvarAgendamento(event)">
                            <input type="hidden" id="agendamento-id">
                            
                            <!-- Cliente -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Cliente *</label>
                                <select 
                                    id="agendamento-cliente" 
                                    required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-700 focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 focus:outline-none transition-all duration-200"
                                >
                                    <option value="">Selecione um cliente</option>
                                </select>
                            </div>
                            
                            <!-- Manicure -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Manicure *</label>
                                <select 
                                    id="agendamento-manicure" 
                                    required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-700 focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 focus:outline-none transition-all duration-200"
                                >
                                    <option value="">Selecione uma manicure</option>
                                </select>
                            </div>
                            
                            <!-- Data e Horário -->
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Data *</label>
                                    <input 
                                        type="date" 
                                        id="agendamento-data" 
                                        required 
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-700 focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 focus:outline-none transition-all duration-200"
                                    >
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Horário *</label>
                                    <input 
                                        type="time" 
                                        id="agendamento-horario" 
                                        required 
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-700 focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 focus:outline-none transition-all duration-200"
                                    >
                                </div>
                            </div>
                            
                            <!-- Status -->
                            <div class="mb-8">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Status *</label>
                                <select 
                                    id="agendamento-status" 
                                    required 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-700 focus:border-violet-500 focus:ring-2 focus:ring-violet-500/20 focus:outline-none transition-all duration-200"
                                >
                                    <option value="">Selecione o status</option>
                                    <option value="Agendado">Agendado</option>
                                    <option value="Confirmado">Confirmado</option>
                                    <option value="Em Andamento">Em Andamento</option>
                                    <option value="Concluído">Concluído</option>
                                    <option value="Cancelado">Cancelado</option>
                                </select>
                            </div>
                            
                            <!-- Buttons -->
                            <div class="flex gap-4">
                                <button 
                                    type="button" 
                                    onclick="window.location.href='index.html'" 
                                    class="flex-1 bg-gray-100 text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-200 transition-all duration-300"
                                >
                                    Cancelar
                                </button>
                                <button 
                                    type="submit" 
                                    class="flex-1 bg-violet-500 hover:bg-purple-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300"
                                >
                                    <span id="btn-text">Salvar</span>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Data Storage
        function getStorageData(key) {
            return JSON.parse(localStorage.getItem(key) || '[]');
        }

        function setStorageData(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        // Get URL parameters
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Load clientes for select
        function carregarClientes() {
            const clientes = getStorageData('clientes');
            const select = document.getElementById('agendamento-cliente');
            
            clientes.forEach(cliente => {
                const option = document.createElement('option');
                option.value = cliente.id;
                option.textContent = cliente.nome;
                select.appendChild(option);
            });
        }

        // Load manicures for select
        function carregarManicures() {
            const manicures = getStorageData('manicures');
            const select = document.getElementById('agendamento-manicure');
            
            manicures.forEach(manicure => {
                const option = document.createElement('option');
                option.value = manicure.id;
                option.textContent = manicure.nome;
                select.appendChild(option);
            });
        }

        // Load agendamento for editing
        function carregarAgendamento() {
            const id = getUrlParameter('id');
            if (id) {
                const agendamentos = getStorageData('agendamentos');
                const agendamento = agendamentos.find(a => a.id == id);
                
                if (agendamento) {
                    document.getElementById('page-title').textContent = 'Editar Agendamento';
                    document.getElementById('btn-text').textContent = 'Atualizar';
                    document.getElementById('agendamento-id').value = agendamento.id;
                    document.getElementById('agendamento-cliente').value = agendamento.clienteId;
                    document.getElementById('agendamento-manicure').value = agendamento.manicureId;
                    document.getElementById('agendamento-data').value = agendamento.data;
                    document.getElementById('agendamento-horario').value = agendamento.horario;
                    document.getElementById('agendamento-status').value = agendamento.status;
                }
            }
        }

        // Save agendamento
        function salvarAgendamento(e) {
            e.preventDefault();
            
            const id = document.getElementById('agendamento-id').value;
            const data = document.getElementById('agendamento-data').value;
            
            // Validate date is not in the past
            const today = new Date();
            const selectedDate = new Date(data + 'T00:00:00');
            
            if (!id && selectedDate < today.setHours(0,0,0,0)) {
                alert('Não é possível agendar para uma data passada!');
                return;
            }
            
            const agendamento = {
                id: id || Date.now(),
                clienteId: document.getElementById('agendamento-cliente').value,
                manicureId: document.getElementById('agendamento-manicure').value,
                data: data,
                horario: document.getElementById('agendamento-horario').value,
                status: document.getElementById('agendamento-status').value
            };

            let agendamentos = getStorageData('agendamentos');

            if (id) {
                // Update existing
                const index = agendamentos.findIndex(a => a.id == id);
                if (index !== -1) {
                    agendamentos[index] = agendamento;
                }
            } else {
                // Add new
                agendamentos.push(agendamento);
            }

            setStorageData('agendamentos', agendamentos);
            
            // Show success message and redirect
            alert(id ? 'Agendamento atualizado com sucesso!' : 'Agendamento cadastrado com sucesso!');
            window.location.href = 'index.html';
        }

        // Logout
        function logout() {
            if (confirm('Deseja realmente sair?')) {
                window.location.href = '../login.html';
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            carregarClientes();
            carregarManicures();
            carregarAgendamento();
            
            // Set minimum date to today
            if (!getUrlParameter('id')) {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('agendamento-data').min = today;
                document.getElementById('agendamento-status').value = 'Agendado';
            }
        });
    </script>
</body>
</html>